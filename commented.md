Здравствуйте. Меня зовут Степан, буду рад знакомству и дальнейшей работе с Вами. 

Гитхаб у меня почему-то не хочет работать :С 
Поэтому оставляю ссылочку на проект (на всякий случай): https://github.com/Saxar1/de-project-sprint-6.git

На ревью отправляю только основные файлы, чтобы удобнее было оставлять комментарии в коде. 

Шаг 1. Загрузить данные из S3
Напишите DAG в Airflow, чтобы подключиться к бакету sprint6 в S3 и выгрузить файл group_log.csv в папку data.

**Выполнено, path: /dags/get_group_log.py

Шаг 2. Создать таблицу group_log в Vertica
Заведите таблицу group_log в схеме *_STAGING с учётом формата данных в скачанном файле.

**Выполнено, path: /DDL/create_group_log.sql

Шаг 3. Загрузить данные в Vertica
Реализуйте DAG, который будет считывать из папки data файл group_log.csv и загружать его в созданную таблицу group_log в схеме *__STAGING.

**Выполнено, path: /dags/load_group_log_to_stg.py

Шаг 4. Создать таблицу связи
Добавьте в схему *__DWH таблицу связи l_user_group_activity с такими полями:
- hk_l_user_group_activity — основной ключ типа INT;
- hk_user_id — внешний ключ типа INT, который связан с основным ключом хаба MY__DWH.h_users;
- hk_group_id — внешний ключ типа INT, который связан с основным ключом хаба MY__DWH.h_groups;
- load_dt — временная отметка типа DATETIME о том, когда были загружены данные;
- load_src — данные об источнике типа VARCHAR(20).

**Выполнено, path: /DDL/create_l_user_group_activity.sql

Шаг 5. Создать скрипты миграции в таблицу связи
Напишите SQL-скрипт миграции данных из *__STAGING.group_log в линк l_user_group_activity.
Вставьте в таблицу l_user_group_activity данные с помощью INSERT и запроса из таблиц *__STAGING.group_log . Вам потребуется сделать JOIN хэш-ключей из таблицы хабов пользователей *__DWH.h_users и таблицы групп *__DWH.h_groups.

**Выполнено, path: /DDL/insert_l_user_group_activity.sql

Шаг 6. Создать и наполнить сателлит
Добавьте в схему *__DWH сателлит s_auth_history и наполните его данными из *__STAGING.group_log и необходимых таблиц в хранилище через скрипт миграции.
Таблицу-сателлит создайте с набором полей:
  - hk_l_user_group_activity — внешний ключ к ранее созданной таблице связей типа INT. Напомним, в сателлитах нет первичных ключей.
  - user_id_from — идентификатор того пользователя, который добавил в группу другого. Если новый участник вступил в сообщество сам, это поле пустое. Задайте атрибуту user_id_from тип INT и наполните его из исходных загруженных данных *__STAGING.group_log.
  - event — событие пользователя в группе;
  - event_dt — дата и время, когда совершилось событие;
  - load_dt и load_src — знакомые вам технические поля.

Для наполнения сателлита используйте основной источник загруженных данных *__STAGING.group_log в связке с необходимыми таблицами:
  - MY__DWH.h_groups — для связи по хеш-ключу группы данных из MY__DWH.l_user_group_activity;
  - MY__DWH.h_users — для связи по хэш-ключу пользователя данных из MY__DWH.l_user_group_activity.

**Выполнено, path: /DDL/s_auth_history.sql

Шаги 7. Подготовить CTE для ответов бизнесу
Вы мигрировали данные и разложили их в реализованной модели данных для оптимального хранения. Теперь вам нужно реализовать два временные таблицы (Common Table Expression — CTE) для оптимального обращения к данным. К ним вы обратитесь, чтобы получить нужные ответы о доле пользователей, которые пишут в группах, относительно пользователей, которые просто вступили в группу. 

Шаг 7.1. Подготовить CTE user_group_messages
Начните с таблицы, которая поможет с анализом доли пользователей, которые активны в группах (user_group_messages) — пишут туда что-то.
Напишите SQL-запрос, который создаст CTE user_group_messages, а внутри:
реализуйте вложенный запрос, который будет возвращать хэш-ключ каждой группы hk_group_id и количество пользователей в группе, которые написали хотя бы раз — cnt_users_in_group_with_messages
не забудьте, что нужно учитывать только уникальных пользователей
Запустите запрос к данным из user_group_messages для подтверждения корректности рассчётов.

**Выполнено, path: /DDL/user_group_messages.sql

Шаг 7.2. Подготовить CTE user_group_log
Создайте временную таблицу, из которой сможете получать количество пользователей, вступивших в группы.
Напишите SQL-запрос, который создаст CTE user_group_log, а внутри:
реализуйте вложенный запрос, который вернёт хэш-ключ каждой группы hk_group_id и количество пользователей в группе, которые в неё просто вступили cnt_added_users
не забудьте учесть только уникальных пользоватей
возьмите только 10 самых ранних созданных групп (таблица MY__DWH.h_groups, самые ранние группы по значению в поле registration_dt)
для получения всех событий добавления в группу event = 'add’ удобно использовать таблицу MY__DWH.s_auth_history
Запустите запрос к данным из user_group_log для подтверждения корректности рассчётов.

**Выполнено, path: /DDL/user_group_log.sql

Шаг 7.3. Написать запрос и ответить на вопрос бизнеса
Временные таблицы вы написали, теперь можно обратиться к ним, чтобы вывести нужные бизнесу ответы.
Напишите SQL-запрос, который выведет по десяти самым старым группам:
Хэш-ключ группы hk_group_id
Количество новых пользователей группы (event = add). Назовите поле cnt_added_users
Количество пользователей группы, которые написали хотя бы одно сообщение. Назовите поле cnt_users_in_group_with_messages
Долю пользователей группы, которые начали общаться. Назовите выводимое поле group_conversion
Отсортируйте результаты по убыванию значений поля group_conversion.

**Выполнено, path: /DDL/business_response.sql